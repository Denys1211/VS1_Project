<template name="taxRatesSettings">
  <div class="container-fluid">
    <div class="fullScreenSpin" style="display:none;">
      <div class="spinner"></div>
    </div>
    <div class="row">
      <div class="col-12 col-md-4">
        <h3 class="text-dark mb-4">Tax Rate Settings
          <!-- <a role="button" data-toggle="modal" href="#helpModal" class="helpModal"><label class="lblplay">PLAY</label><i class="far fa-play-circle"  style="font-size: 20px;"></i></a> -->
          <a role="button" data-toggle="modal" href="#helpViewModal" style="font-size: 20px;">Help <i
              class="fa fa-question-circle-o" style="font-size: 20px;"></i></a>

          <!-- Start Help View Modal -->
          <div class="modal fade" role="dialog" tabindex="-1" id="helpViewModal">
            <div class="modal-dialog modal-sm" role="document">
              <div class="modal-content">
                <div class="modal-header" style="padding-bottom: 8px;">
                  <h4>Help</h4><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                      aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body">
                  <p class="text-center text-muted"><a role="button" data-toggle="modal" href="#helpModal"
                      class="btn btn-primary helpModal">View Help Video</a></p>
                  <p class="text-center text-muted"><a href="https://vs1forum.com/viewtopic.php?f=6&t=22"
                      target="_blank" class="btn btn-primary">Download Help File</a></p>
                  <p class="text-center text-muted"><button class="btn btn-primary" type="button">Employ
                      Advisor</button></p>
                  <p class="text-center text-muted" style="margin: 0px;"><a
                      href="https://vs1forum.com/ucp.php?mode=register&cloudusername={{loggedCompany}}" target="_blank"
                      class="btn btn-primary">Go To Forum</a></p>
                </div>
                <div class="modal-footer" style="padding: 6px;"><button class="btn btn-light" data-dismiss="modal"
                    type="button">Close</button></div>
              </div>
            </div>
          </div>
          <!-- End Help View Modal -->
        </h3>
      </div>
      <div class="col-12 col-md-4">{{> loggedcompanyoverview}}</div>
    </div>
    <div class="row mb-3">
      <div class="col">
        <div class="row">
          <div class="col">
            <div class="card shadow mb-3">
              <div class="card-header py-3">
                <p class="text-primary m-0 font-weight-bold">Active Tax Rates</p>

              </div>
              <div class="card-body">
                <div class="card-body p-3 rounded">

                  <div class="row no-gutters">
                    <div class="col">
                      <div class="row d-xl-flex flex-row justify-content-xl-center">

                        <div class="col d-xl-flex flex-grow-1 align-items-xl-start" style="padding: 0px !important;">
                          <button id="btnRefresh" class="btn btn-primary btnRefresh btnNav " type="button"
                            style="min-width: 117.016px;margin :14px;"><i class="la la-lightbulb-o"
                              style="margin-right: 5px;"></i>Refresh</button>





                          <a class="btn btn-primary btnAddTaxRate" role="button" data-toggle="modal"
                            href="#addNewTaxRate" style="margin-top: 16px; margin:14px;"><i class="fa fa-plus"
                              style="margin-right: 14px;"></i>Add New Tax
                            Rate<br></a>

                          <a class="btn btn-primary btnInactiveTax" role="button" data-toggle="modal" href="#"
                            style="margin-top: 16px; margin:14px;">Inactive Tax Codes</a>

                          <button class="btn btn-primary btnSubTaxes" role="button"
                            style="margin-top: 14px;margin:14px; display: none;"><i class="fa fa-list"
                              style="margin-right: 8px;"></i>Sub Taxes<br></button>

                          <button class="btn btn-primary btnTaxSummary" role="button"
                            style="margin-top: 14px;margin:14px; display: none;"><i class="fa fa-list"
                              style="margin-right: 8px;"></i>Tax Summary<br></button>

                          <div class="modal fade" role="dialog" tabindex="-1" id="addNewTaxRate">
                            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <!-- <h4 id="add-tax-title" name="add-tax-title">Add New Tax Rate</h4> -->
                                  <h4 style="">
                                    <div id="add-tax-title" name="add-tax-title" style="float: left;">Add New Tax Rate
                                    </div> <a role="button" data-toggle="modal" href="#helpModalAdd"
                                      class="helpModalAdd" style="float: right;"><label class="lblplay">PLAY</label><i
                                        class="far fa-play-circle" style="font-size: 20px;"></i></a>
                                  </h4>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                      aria-hidden="true">×</span></button>
                                </div>
                                <div class="modal-body">
                                  <input type="hidden" class="form-control" id="edtTaxID" name="edtTaxID"
                                    style="display:none;">
                                  <div class="row no-gutters">
                                    <div class="col d-xl-flex align-items-xl-end">
                                      <div class="form-group flex-grow-1" style="margin: 8px;"><label
                                          data-toggle="tooltip" data-bs-tooltip="" data-placement="bottom">Name</label>
                                        <input type="text" class="form-control" id="edtTaxName" name="edtTaxName">
                                      </div>
                                      <div class="form-group" style="margin: 8px;">
                                        <label data-toggle="tooltip" data-bs-tooltip="" data-placement="bottom">Rate
                                          %</label>
                                        <input type="text" class="form-control" style="width: 110px;" placeholder="0"
                                          id="edtTaxRate" name="edtTaxRate">
                                      </div>
                                    </div>
                                  </div>
                                  <div class="row no-gutters">
                                    <div class="col d-xl-flex align-items-xl-end">
                                      <div class="form-group flex-grow-1" style="margin: 8px;">
                                        <label data-toggle="tooltip" data-bs-tooltip=""
                                          data-placement="bottom">Description</label>
                                        <input type="text" class="form-control" id="edtTaxDesc" name="edtTaxDesc">
                                      </div>
                                      <!-- <div class="form-group" style="margin: 8px;"><label>Rate</label><input type="text" class="form-control" style="width: 110px;" placeholder="0 %"></div> -->
                                    </div>
                                  </div>

                                  {{#if isChkUSRegionTax}}
                                  <div class="row no-gutters">
                                    <label data-toggle="tooltip" data-bs-tooltip="" data-placement="bottom"
                                      style="margin: 10px 0 0 0;">Sub Taxcodes</label>
                                    <table id="subTaxList" style="width: 100%;"
                                      class="dataTable table table-hover table-striped table-bordered subTaxList">
                                      <thead>
                                        <tr class="dnd-moved">
                                          <th class="th colCode" style="width:100px">
                                            Code</th>
                                          <th class="th colPercent">Percent</th>
                                          <th class="th colPercentageOn" style="width:150px">Percentage On</th>
                                          <th class="th colCapAmt" style="width:150px">Cap Amt</th>
                                          <th class="th colThresholdAmt" style="width:150px">Threshold Amt</th>
                                          <th class="th colDelete" style="width:20px"></th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        {{#if subtaxlines}}
                                        {{#each item in subtaxlines}}
                                        <tr class="dnd-moved" id="{{item.RowId}}" style="cursor: pointer;">
                                          <td contenteditable="false" class="colName clickable">
                                            {{item.SubTaxCode}}</td>
                                          <td contenteditable="false" class="colPercent clickable">{{item.Percentage}}
                                          </td>
                                          <td contenteditable="false" class="colPercentageOn clickable">
                                            {{item.PercentageOn}}</td>
                                          <td contenteditable="false" class="colCapAmt clickable">{{item.CapAmount}}
                                          </td>
                                          <td contenteditable="false" class="colThresholdAmt clickable">
                                            {{item.ThresholdAmount}}</td>
                                          <td contenteditable="false" class="colDelete"><span
                                              class="table-remove"><button type="button"
                                                class="btn btn-danger btn-rounded btn-sm my-0"><i
                                                  class="fa fa-remove"></i></button></span></td>
                                        </tr>
                                        {{/each}}
                                        {{else}}
                                        <tr class="dnd-moved" style="cursor: pointer;">
                                          <td contenteditable="false" colspan="6" style="text-align: center;">
                                            <span>
                                              Table data doesn't exist
                                            </span>
                                          </td>
                                        </tr>
                                        {{/if}}
                                      </tbody>
                                    </table>
                                  </div>
                                  {{/if}}
                                </div>
                                <div class="modal-footer">
                                  <button class="btn btn-success btnSaveTaxRate" type="button"><i class="fa fa-save"
                                      style="padding-right: 8px;"></i>Save</button>
                                  {{#if isChkUSRegionTax}}
                                  <button class="btn btn-primary btnNewSubTax" data-toggle="modal"
                                    href="#addSubTaxModal" type="button"><i class="fa fa-plus"
                                      style="padding-right: 8px;"></i>Sub</button>
                                  {{/if}}
                                  <button class="btn btn-secondary" data-dismiss="modal" type="button"><i
                                      class="fa fa-close" style="margin-right: 8px;"></i>Close</button>
                                </div>
                              </div>
                            </div>
                          </div>

                        </div>


                        <div class="col d-xl-flex justify-content-xl-end align-items-xl-start"
                          style="padding: 0px !important;">
                          {{> export_import_print_display_button tablename="taxRatesList"}}
                        </div>

                      </div>
                      <!--
                                            <button class="btn btn-primary btnRefresh float-left" type="button"
                                                style="margin: 16px 0px; margin-right: 24px;"><i
                                                    class="la la-lightbulb-o"
                                                    style="padding-right: 5px;"></i>Refresh</button> -->

                      <div class="modal fade" role="dialog" tabindex="-1" id="addSubTaxModal">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h4>
                                <div id="add-subtax-title" name="add-tax-title" style="float: left;">Add Sub Tax</div>
                              </h4>
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                  aria-hidden="true">×</span></button>
                            </div>
                            <div class="modal-body">
                              <input type="hidden" class="form-control" id="edtSubTaxLineId" name="edtSubTaxLineId"
                                style="display:none;">
                              <div class="row no-gutters">
                                <div class="col-6 d-xl-flex align-items-xl-end">
                                  <div class="form-group flex-grow-1" style="margin: 8px;">
                                    <label data-toggle="tooltip" data-bs-tooltip="" data-placement="bottom">Code</label>
                                    <select class="form-control" id="subTaxCode" name="subTaxCode">
                                      <option value="" disabled>Select</option>
                                      {{#each item in subtaxcodes}}
                                      <option value="{{item.codename}}">
                                        {{item.codename}}</option>
                                      {{/each}}
                                    </select>
                                  </div>
                                </div>
                                <div class="col-6 d-xl-flex align-items-xl-end">
                                  <div class="form-group flex-grow-1" style="margin: 8px;">
                                    <label data-toggle="tooltip" data-bs-tooltip=""
                                      data-placement="bottom">Percent</label>
                                    <input type="text" class="form-control" id="subTaxPercent" name="subTaxPercent">
                                  </div>
                                </div>
                                <div class="col-6 d-xl-flex align-items-xl-end">
                                  <div class="form-group flex-grow-1" style="margin: 8px;">
                                    <label data-toggle="tooltip" data-bs-tooltip="" data-placement="bottom">Percentage
                                      On</label>
                                    <select class="form-control" id="subTaxPercentageOn" name="subTaxPercentageOn">
                                      <option value="" disabled>Select</option>
                                      <option value="Selling Price">Selling Price
                                      </option>
                                      {{#each item in subtaxcodes}}
                                      <option value="{{item.codename}}">
                                        {{item.codename}}</option>
                                      {{/each}}
                                    </select>
                                  </div>
                                </div>
                                <div class="col-6 d-xl-flex align-items-xl-end">
                                  <div class="form-group flex-grow-1" style="margin: 8px;">
                                    <label data-toggle="tooltip" data-bs-tooltip="" data-placement="bottom">Cap
                                      Amt</label>
                                    <input type="text" class="form-control" id="subTaxCapAmt" name="subTaxCapAmt"
                                      value="0">
                                  </div>
                                </div>
                                <div class="col-6 d-xl-flex align-items-xl-end">
                                  <div class="form-group flex-grow-1" style="margin: 8px;">
                                    <label data-toggle="tooltip" data-bs-tooltip="" data-placement="bottom">Threshold
                                      Amt</label>
                                    <input type="text" class="form-control" id="subTaxThresholdAmt"
                                      name="subTaxThresholdAmt" value="0">
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="modal-footer">
                              <button class="btn btn-success btnSaveSubTax" type="button"><i class="fa fa-save"
                                  style="padding-right: 8px;"></i>Save</button>
                              <button class="btn btn-secondary" data-dismiss="modal" type="button"><i
                                  class="fa fa-close" style="margin-right: 8px;"></i>Close</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <style>
                    .newTaxRate {
                      display: none;
                      padding: 16px;
                      margin: 16px 0px 0px 0px;
                    }
                  </style>
                  <script>
                    //onclick="showHiddenDiv()"
                    function showHiddenDiv() {
                      var x = document.getElementById("newTaxRate");
                      if (x.style.display === "none") {
                        x.style.display = "block";
                      } else {
                        x.style.display = "none";
                      }
                    }
                  </script>
                  <div class="card newTaxRate" id="newTaxRate">
                    <div class="row no-gutters d-xl-flex flex-column justify-content-xl-center">
                      <div class="col d-xl-flex align-items-xl-end">
                        <div class="form-group flex-grow-1" style="margin: 8px;"><label data-toggle="tooltip"
                            data-bs-tooltip="" data-placement="bottom"
                            title="The name for the Tax Rate to appear in VS1 Cloud">Name</label><input type="text"
                            class="form-control"></div>
                        <div class="form-group flex-grow-1" style="margin: 8px;"><label data-toggle="tooltip"
                            data-bs-tooltip="" data-placement="bottom"
                            title="The name for the Tax Rate to appear in VS1 Cloud">Tax
                            Type</label><select class="custom-select">
                            <optgroup label="This is a group">
                              <option value="12" selected="">This is item 1</option>
                              <option value="13">This is item 2</option>
                              <option value="14">This is item 3</option>
                            </optgroup>
                          </select></div>
                        <div class="form-group flex-grow-0" style="margin: 8px;"><label data-toggle="tooltip"
                            data-bs-tooltip="" data-placement="bottom"
                            title="The name for the Tax Rate to appear in VS1 Cloud">Percentage</label><input
                            type="text" class="form-control" placeholder="0 %"></div>
                        <div class="form-group flex-grow-1" style="margin: 8px;"><label data-toggle="tooltip"
                            data-bs-tooltip="" data-placement="bottom"
                            title="The name for the Tax Rate to appear in VS1 Cloud">Description</label><input
                            type="text" class="form-control"></div>
                      </div>
                    </div>
                    <div class="row no-gutters">
                      <div class="col">
                        <button class="btn btn-secondary float-right btnCloseAddNewTax" type="button"
                          style="margin: 8px;"><i class="fa fa-close" style="margin-right: 5px;"></i>Cancel</button>
                        <button class="btn btn-success float-right" type="button" style="margin: 8px;"><i
                            class="fa fa-save" style="margin-right: 5px;"></i>Save</button>
                      </div>
                    </div>
                  </div>
                  <!-- Start {{> optionNavSalesOverview}} -->
                  <!-- End -->
                  <div class="table-responsive">
                    <style>
                      .hiddenColumn {
                        display: none;
                      }

                      .showColumn {
                        display: table-cell;
                        padding: .75rem;
                        vertical-align: top;
                      }
                    </style>

                    {{> DeleteLineModal}}
<!--                    {{> non_transactional_list tablename='taxRatesList'}}-->

                      <style>
                          td.colTaxRatePurchaseDefault, td.colTaxRateSalesDefault{
                              text-align: center !important;
                          }
                      </style>
                      {{>datatablelist
                              tablename="taxRatesList"
                              apiName= apiFunction
                              indexeddbname = 'TTaxcodeVS1'
                              tableheaderrecords = tableheaderrecords
                              exportfilename = 'Tax Rates List'
                              istransaction = false
                              apiParams= apiParams
                              datahandler = datahandler
                              service=service
                              lowercaseDataName='ttaxcodevs1'
                              exIndexDBName = 'ttaxcodevs1'
                              exdatahandler = exDataHandler
                              searchAPI = searchAPI
                      }}
                  </div>
                </div>
                <div class="row no-gutters">
                  <div class="col">
                    <button class="btn btn-secondary float-right btnBack" type="button" style="margin: 12px;"><i
                        class="fa fa-close" style="margin-right: 5px;"></i>Cancel</button>
                    <button class="btn btn-success float-right btnSaveDefaultTax" type="button" style="margin: 12px;"><i
                        class="fa fa-save" style="margin-right: 5px;"></i>Save</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Start Help Video Modal -->
  <div class="modal fade" role="dialog" tabindex="-1" id="helpModal">
    <div class="modal-dialog" role="document" style="max-width: 670px!important;">
      <div class="modal-content">
        <div class="modal-header">

          <h4 class="title-header">Tax Rate</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
              aria-hidden="true">×</span></button>
        </div>
        <div class="modal-body">
          <!-- <iframe width="640" height="360" src="https://player.vimeo.com/video/99892791" frameborder="0" allowfullscreen=""></iframe> -->
          <!-- <iframe width="640" height="360" src="https://erphelpes.com/vs1videos/taxratelist.mp4" frameborder="0" allowfullscreen=""></iframe> -->
          <video preload="none" id="myVideo" width="640" height="360" controls="" name="media"
            style="border: solid 5px #999999f0; height: auto; outline: none;">
            <source src="https://erphelpes.com/vs1videos/taxrate.mp4" type="video/mp4">
          </video>
        </div>
      </div>
    </div>
  </div>

  <!-- End Help Video Modal -->

  <!-- Start Help Video Modal -->
  <div class="modal fade" role="dialog" tabindex="-1" id="helpModalAdd">
    <div class="modal-dialog" role="document" style="max-width: 670px!important;">
      <div class="modal-content">
        <div class="modal-header">

          <h4 class="title-header">New Tax Rate</h4>
          <button type="button" class="close closeAdd" data-dismiss="modal" aria-label="Close"><span
              aria-hidden="true">×</span></button>
        </div>
        <div class="modal-body">
          <!-- <iframe width="640" height="360" src="https://player.vimeo.com/video/99892791" frameborder="0" allowfullscreen=""></iframe> -->
          <!-- <iframe width="640" height="360" src="https://erphelpes.com/vs1videos/taxrate.mp4" frameborder="0" allowfullscreen=""></iframe> -->
          <video preload="none" id="myVideoAdd" width="640" height="360" controls="" name="media"
            style="border: solid 5px #999999f0; height: auto; outline: none;">
            <source src="https://erphelpes.com/vs1videos/newtaxrate.mp4" type="video/mp4">
          </video>
        </div>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  {{> import_template ImportformName="Tax Rates Setting"}}

  <!-- End Help Video Modal -->
  <script>
    modalDraggable();
  </script>
</template>